GRUPOS DE ESTUDO

<div id="meetings">

  <a v-on:click="showCreateMeeting" class="btn btn-primary btn-xl">Agendar</a>
  <div v-show="add_meeting">
    Inicio: <input type="text" v-model="meeting.initial_date" class="datepicker" data-date-format="mm/dd/yyyy"><br>
    Fim: <input type="text" v-model="meeting.end_date" class="datepicker" data-date-format="mm/dd/yyyy"><br>
    Horario inicio: <input type="text" v-model="meeting.start_time" class="timepicker"><br>
    Horario fim: <input type="text" v-model="meeting.end_time"><br>
    Periodicidade:
    <span v-show="add_meeting_week_day">
      <input type="checkbox" v-model="meeting.week_days[0]">Domingo</input>
      <input type="checkbox" v-model="meeting.week_days[1]">Segunda</input>
      <input type="checkbox" v-model="meeting.week_days[2]">Terca</input>
      <input type="checkbox" v-model="meeting.week_days[3]">Quarta</input>
      <input type="checkbox" v-model="meeting.week_days[4]">Quinta</input>
      <input type="checkbox" v-model="meeting.week_days[5]">Sexta</input>
      <input type="checkbox" v-model="meeting.week_days[6]">Sabado</input>
    </span>
    <input type="text" v-model="meeting.multiplier" v-show="add_meeting_periodicity">

    -
    <select v-model="meeting.periodicity" v-on:change="periodicityChange">
      <option value="dia">dia</option>
      <option value="dia_semana">dia semana</option>
      <option value="semana">semana</option>
      <option value="mes">mes</option>
      <option value="ano">ano</option>
    </select>
    
    <a v-on:click="createNewMeeting" class="btn btn-primary btn-xl">Criar</a>
    <a v-on:click="hideCreateMeeting" class="btn btn-primary btn-xl">Cancela</a>
  </div>

  <ul>
    <li v-for="meeting in meetings" >
      D: {{ meeting.date }}
      <a href="/group_meeting/{{ meeting.id }}">==></a>
    </li>
  </ul>

  <!--
  <script src="//code.jquery.com/jquery-1.10.2.js"></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

  <script>
    $(function() {
      // /$( ".timepicker" ).timepicker();
      $( ".datepicker" ).datepicker({
          dateFormat: 'dd/mm/yy',
          dayNames: ['Domingo','Segunda','Terça','Quarta','Quinta','Sexta','Sábado'],
          dayNamesMin: ['D','S','T','Q','Q','S','S','D'],
          dayNamesShort: ['Dom','Seg','Ter','Qua','Qui','Sex','Sáb','Dom'],
          monthNames: ['Janeiro','Fevereiro','Março','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],
          monthNamesShort: ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],
          nextText: 'Próximo',
          prevText: 'Anterior'
      });
    });
  </script>
-->

</div>

<script>

var meetings = new Vue({
  el: '#meetings',
  data: {
    meetings: [],
    meeting:
    {
      initial_date: '12/12/2015',
      end_date: '20/01/2016',
      start_time: '12:12',
      end_time: '',
      multiplier: 1,
      periodicity: 1,
      week_days: [false, true, true, true, true, true, false],
      group_id: ''
    },
    add_meeting: false,
    add_meeting_week_day: false,
    add_meeting_periodicity: true
  },
  ready: function() {
    $('.datepicker').datepicker({
        startDate: '-3d'
    });
  },
  methods: {
    setGroup: function (group_id) {
      //alert(group_id);
      this.meeting.group_id = group_id;

      var that;
      that = this;
      $.ajax({
        method: 'POST',
        url: '/meetings/list.json',
        data: {
          id: this.meeting.group_id
        },
        success: function(res) {
          that.meetings = res;
        }
      });
    },
    showCreateMeeting: function () {
      this.add_meeting = true;
    },
    hideCreateMeeting: function () {
      this.add_meeting = false;
    },
    createNewMeeting: function () {
      var that = this;
      $.ajax({
        method: 'POST',
        data: this.meeting,
        url: '/meetings/generate.json',
        success: function(res) {
          that.errors = {}
          
          that.meetings = res;
          that.add_meeting = false;
        },
        error: function(res) {
          that.errors = res.responseJSON.errors
        }
      })
    },
    periodicityChange: function()
    {
      //alert('change:' + this.meeting.periodicity);
      if (this.meeting.periodicity == 'dia_semana')
      {
        this.add_meeting_week_day = true;
        this.add_meeting_periodicity = false;
      }
      else
      {
        this.add_meeting_week_day = false;
        this.add_meeting_periodicity = true;
      }
    }
  }
});


  meetings.setGroup(<%= @group_id %>);
</script>